import{g as N,u as V,h as X,i as Z,j as ee,t as le,k as se,l as q,m as f,n as e,p as ae,q as te,s as re,R as P,v as ie,x as oe,y as ce,z as ue,A as ne,B as F,C as B,D as he,E as ye,F as me,G as de,L as ve,H as pe,I as Ce,J as Se,K as $,M as ge,N as k}from"./app-BilCrUEp.js";const Ee=["/","/AD/FastSelectCourse.html","/EasyCollege/","/EasySchool/CampusCard.html","/EasySchool/MilitaryTraining.html","/EasySchool/","/EasySchool/SmartQuYuan.html","/EasySelectCourse/Contributors.html","/EasySelectCourse/","/EasySelectCourse/SelectionStrategy.html","/Other/","/QuickStart/Agreement.html","/QuickStart/","/QuickStart/Sponsor.html","/QuickStart/Thank.html","/EasyCollege/Bioscience/Building.html","/EasyCollege/Bioscience/Club.html","/EasyCollege/Bioscience/Major.html","/EasyCollege/Bioscience/","/EasyCollege/Bioscience/Union.html","/EasyCollege/Chemistry/BallTeams.html","/EasyCollege/Chemistry/Learning.html","/EasyCollege/Chemistry/Location.html","/EasyCollege/Chemistry/Others.html","/EasyCollege/Chemistry/","/EasyCollege/Chemistry/TrainingProgram.html","/EasyCollege/Chemistry/Union.html","/EasyCollege/Physics/Club.html","/EasyCollege/Physics/Location.html","/EasyCollege/Physics/Major.html","/EasyCollege/Physics/","/EasyCollege/Physics/Rules.html","/EasyCollege/Physics/Union.html","/EasySelectCourse/SelectionGuide/2024Sports.html","/EasySelectCourse/SelectionGuide/Criticism.html","/EasySelectCourse/SelectionGuide/English.html","/EasySelectCourse/SelectionGuide/HowToFind.html","/EasySelectCourse/SelectionGuide/HowToSelect.html","/EasySelectCourse/SelectionGuide/PublicElective.html","/EasySelectCourse/SelectionGuide/","/EasySelectCourse/SelectionGuide/SelectionModule.html","/EasySelectCourse/SelectionGuide/Sports.html","/EasySelectCourse/SelectionGuide/TeacherEducation.html","/EasySelectCourse/SelectionGuide/WhatToSelect.html","/404.html","/AD/"],He="SLIMSEARCH_QUERY_HISTORY",C=$(He,[]),fe=()=>{const{queryHistoryCount:t}=k;return{enabled:t>0,queryHistories:C,addQueryHistory:c=>{C.value=Array.from(new Set([c,...C.value.slice(0,t-1)]))},removeQueryHistory:c=>{C.value=[...C.value.slice(0,c),...C.value.slice(c+1)]}}},T=t=>Ee[t.id]+("anchor"in t?`#${t.anchor}`:""),ke="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=k,S=$(ke,[]),Qe=()=>({enabled:M>0,resultHistories:S,addResultHistory:o=>{{const c={link:T(o),display:o.display};"header"in o&&(c.header=o.header),S.value=[c,...S.value.slice(0,M-1)]}},removeResultHistory:o=>{S.value=[...S.value.slice(0,o),...S.value.slice(o+1)]}}),be=t=>{const{page:o,routeLocale:c}=he(),Q=ye(),r=q(0),g=f(()=>r.value>0),h=me([]);return de(()=>{const{search:b,terminate:d}=ve(),E=Ce(v=>{const{resultsFilter:R=a=>a,querySplitter:p,suggestionsFilter:D,...i}=Q.value;v?(r.value+=1,b(v,c.value,i).then(a=>R(a,v,c.value,o.value)).then(a=>{r.value-=1,h.value=a}).catch(a=>{console.warn(a),r.value-=1,r.value||(h.value=[])})):h.value=[]},k.searchDelay-k.suggestDelay,{maxWait:5e3});pe([t,c],([v])=>E(v.join(" "))),Se(()=>{d()})}),{isSearching:g,results:h}};var we=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const c=V(),Q=X(),r=Z(ee),{addQueryHistory:g,queryHistories:h,removeQueryHistory:b}=fe(),{resultHistories:d,addResultHistory:E,removeResultHistory:v}=Qe(),R=le(t,"queries"),{results:p,isSearching:D}=be(R),i=se({isQuery:!0,index:0}),a=q(0),y=q(0),G=f(()=>h.value.length>0||d.value.length>0),w=f(()=>p.value.length>0),x=f(()=>p.value[a.value]||null),I=()=>{const{isQuery:l,index:s}=i;s===0?(i.isQuery=!l,i.index=l?d.value.length-1:h.value.length-1):i.index=s-1},U=()=>{const{isQuery:l,index:s}=i;s===(l?h.value.length-1:d.value.length-1)?(i.isQuery=!l,i.index=0):i.index=s+1},j=()=>{a.value=a.value>0?a.value-1:p.value.length-1,y.value=x.value.contents.length-1},O=()=>{a.value=a.value<p.value.length-1?a.value+1:0,y.value=0},Y=()=>{y.value<x.value.contents.length-1?y.value+=1:O()},_=()=>{y.value>0?y.value-=1:j()},L=l=>l.map(s=>ge(s)?s:e(s[0],s[1])),W=l=>{if(l.type==="customField"){const s=ue[l.index]||"$content",[m,u=""]=ne(s)?s[Q.value].split("$content"):s.split("$content");return l.display.map(n=>e("div",L([m,...n,u])))}return l.display.map(s=>e("div",L(s)))},H=()=>{a.value=0,y.value=0,o("updateQuery",""),o("close")},z=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((l,s)=>{const m=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",l)}},e("div",[e(F,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},l),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:B,onClick:u=>{u.preventDefault(),u.stopPropagation(),b(s)}})]))}))])),J=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((l,s)=>{const m=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(P,{to:l.link,onClick:()=>{H()}},()=>[e(F,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[l.header?e("div",{class:"slimsearch-record-content-header"},l.header):null,e("div",l.display.map(u=>L(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:B,onClick:u=>{u.preventDefault(),u.stopPropagation(),v(s)}})]))}))]));return ae("keydown",l=>{if(t.isFocusing){if(w.value){if(l.key==="ArrowUp")_();else if(l.key==="ArrowDown")Y();else if(l.key==="Enter"){const s=x.value.contents[y.value];g(t.queries.join(" ")),E(s),c.push(T(s)),H()}}else if(l.key==="ArrowUp")I();else if(l.key==="ArrowDown")U();else if(l.key==="Enter"){const{index:s}=i;i.isQuery?(l.preventDefault(),o("updateQuery",h.value[s])):(c.push(d.value[s].link),H())}}}),te([a,y],()=>{var l;(l=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||l.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!w.value:!G.value}]},t.queries.length?D.value?e(re,{hint:r.value.searching}):w.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:l,contents:s},m)=>{const u=a.value===m;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},l||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((n,K)=>{const A=u&&y.value===K;return e("li",{class:["slimsearch-record-matches",{active:A}],role:"option","aria-selected":A},e(P,{to:T(n),onClick:()=>{g(t.queries.join(" ")),E(n),H()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",W(n))])]))}))])})):r.value.emptyResult:G.value?[z(),J()]:r.value.emptyHistory)}});export{we as default};
